<app-page-breadcrumb pageTitle="Image Shortener" />
<div class="space-y-6">
  <app-component-card
    title="Upload image"
    desc="Upload an image as Base64. It is stored on the server and accessible via a short link (/i/{code})."
  >
    <div class="mx-auto max-w-xl">
      <label
        class="flex cursor-pointer flex-col items-center justify-center rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 py-12 transition hover:border-brand-300 hover:bg-brand-50/50 dark:border-gray-700 dark:bg-gray-900/50 dark:hover:border-brand-600 dark:hover:bg-brand-500/5"
        [class.pointer-events-none]="loading()"
        [class.opacity-70]="loading()"
      >
        <input
          type="file"
          accept="image/*"
          class="hidden"
          (change)="onFileSelected($event)"
          [disabled]="loading()"
        />
        <svg
          class="mb-3 size-10 text-gray-400 dark:text-gray-500"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
          />
        </svg>
        <span class="text-theme-sm font-medium text-gray-600 dark:text-gray-400">
          {{ loading() ? 'Uploading…' : 'Choose an image or drag it here' }}
        </span>
        <span class="mt-1 text-theme-xs text-gray-500 dark:text-gray-500">
          PNG, JPEG, GIF, WebP
        </span>
      </label>

      @if (error()) {
        <div
          class="mt-4 rounded-lg border border-error-200 bg-error-50 px-4 py-3 text-theme-sm text-error-700 dark:border-error-800 dark:bg-error-500/10 dark:text-error-400"
          role="alert"
        >
          {{ error() }}
        </div>
      }

      @if (result(); as res) {
        <div
          class="mt-6 rounded-xl border border-gray-200 bg-gray-50 p-6 dark:border-gray-800 dark:bg-gray-900/50"
        >
          <p class="mb-3 text-theme-xs font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400">
            Image short link
          </p>
          <div class="flex flex-wrap items-start gap-6">
            <div class="flex flex-col items-center gap-2">
              <img
                [src]="res.imageUrl"
                [alt]="res.originalFileName || 'Uploaded image'"
                class="max-h-40 rounded-lg border border-gray-200 object-contain dark:border-gray-700"
              />
              <span class="text-theme-xs text-gray-500 dark:text-gray-400">
                Preview
              </span>
            </div>
            <div class="min-w-0 flex-1">
              <div class="mb-2 flex items-center gap-2">
                <a
                  [href]="res.imageUrl"
                  target="_blank"
                  rel="noopener"
                  class="min-w-0 truncate text-theme-sm font-medium text-brand-500 hover:underline"
                >
                  {{ res.imageUrl }}
                </a>
                <button
                  type="button"
                  class="shrink-0 rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-theme-xs font-medium text-gray-700 shadow-theme-xs transition hover:bg-gray-50 dark:border-gray-800 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"
                  (click)="copyImageUrl(res)"
                >
                  {{ copied() ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-theme-xs text-gray-500 dark:text-gray-400">
                Short code: <code class="rounded bg-gray-200 px-1 dark:bg-gray-800">{{ res.shortCode }}</code>
                · View at <code class="rounded bg-gray-200 px-1 dark:bg-gray-800">/i/{{ res.shortCode }}</code>
              </p>
              <p class="mt-3 text-theme-xs font-medium text-gray-500 dark:text-gray-400">
                QR code (points to image URL):
              </p>
              <a [href]="res.imageUrl" target="_blank" rel="noopener" class="inline-block mt-1">
                <img
                  [src]="qrCodeImageUrl(res.imageUrl)"
                  [alt]="'QR for ' + res.shortCode"
                  width="120"
                  height="120"
                  class="rounded border border-gray-200 dark:border-gray-700"
                />
              </a>
            </div>
          </div>
        </div>
      }
    </div>
  </app-component-card>
</div>
